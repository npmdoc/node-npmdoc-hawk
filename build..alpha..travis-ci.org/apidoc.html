<div class="apidocDiv">
<style>
/*csslint
*/
.apidocDiv {
    background: #fff;
    font-family: Arial, Helvetica, sans-serif;
}
.apidocDiv a[href] {
    color: #33f;
    font-weight: bold;
    text-decoration: none;
}
.apidocDiv a[href]:hover {
    text-decoration: underline;
}
.apidocCodeCommentSpan {
    background: #bbf;
    color: #000;
    display: block;
}
.apidocCodeKeywordSpan {
    color: #d00;
    font-weight: bold;
}
.apidocCodePre {
    background: #eef;
    border: 1px solid;
    color: #777;
    padding: 5px;
    white-space: pre-wrap;
}
.apidocFooterDiv {
    margin-top: 20px;
    text-align: center;
}
.apidocModuleLi {
    margin-top: 10px;
}
.apidocSectionDiv {
    border-top: 1px solid;
    margin-top: 20px;
}
.apidocSignatureSpan {
    color: #777;
    font-weight: bold;
}
</style>
<h1>api documentation for
    <a

        href="https://github.com/hueniverse/hawk#readme"

    >hawk (v6.0.1)</a>
</h1>
<h4>HTTP Hawk Authentication Scheme</h4>
<div class="apidocSectionDiv"><a
    href="#apidoc.tableOfContents"
    id="apidoc.tableOfContents"
><h1>table of contents</h1></a><ol>

    <li class="apidocModuleLi"><a href="#apidoc.module.hawk">module hawk</a><ol>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">hawk.</span>Error</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">hawk.</span>client</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">hawk.</span>crypto</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">hawk.</span>error</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">hawk.</span>server</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">hawk.</span>sntp</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">hawk.</span>uri</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">hawk.</span>utils</span>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.hawk.Error">module hawk.Error</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.hawk.Error.badData">
            function <span class="apidocSignatureSpan">hawk.Error.</span>badData
            <span class="apidocSignatureSpan">(message, data)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.hawk.Error.badGateway">
            function <span class="apidocSignatureSpan">hawk.Error.</span>badGateway
            <span class="apidocSignatureSpan">(message, data)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.hawk.Error.badImplementation">
            function <span class="apidocSignatureSpan">hawk.Error.</span>badImplementation
            <span class="apidocSignatureSpan">(message, data)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.hawk.Error.badRequest">
            function <span class="apidocSignatureSpan">hawk.Error.</span>badRequest
            <span class="apidocSignatureSpan">(message, data)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.hawk.Error.clientTimeout">
            function <span class="apidocSignatureSpan">hawk.Error.</span>clientTimeout
            <span class="apidocSignatureSpan">(message, data)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.hawk.Error.conflict">
            function <span class="apidocSignatureSpan">hawk.Error.</span>conflict
            <span class="apidocSignatureSpan">(message, data)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.hawk.Error.create">
            function <span class="apidocSignatureSpan">hawk.Error.</span>create
            <span class="apidocSignatureSpan">(statusCode, message, data)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.hawk.Error.entityTooLarge">
            function <span class="apidocSignatureSpan">hawk.Error.</span>entityTooLarge
            <span class="apidocSignatureSpan">(message, data)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.hawk.Error.expectationFailed">
            function <span class="apidocSignatureSpan">hawk.Error.</span>expectationFailed
            <span class="apidocSignatureSpan">(message, data)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.hawk.Error.forbidden">
            function <span class="apidocSignatureSpan">hawk.Error.</span>forbidden
            <span class="apidocSignatureSpan">(message, data)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.hawk.Error.gatewayTimeout">
            function <span class="apidocSignatureSpan">hawk.Error.</span>gatewayTimeout
            <span class="apidocSignatureSpan">(message, data)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.hawk.Error.illegal">
            function <span class="apidocSignatureSpan">hawk.Error.</span>illegal
            <span class="apidocSignatureSpan">(message, data)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.hawk.Error.internal">
            function <span class="apidocSignatureSpan">hawk.Error.</span>internal
            <span class="apidocSignatureSpan">(message, data, statusCode)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.hawk.Error.lengthRequired">
            function <span class="apidocSignatureSpan">hawk.Error.</span>lengthRequired
            <span class="apidocSignatureSpan">(message, data)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.hawk.Error.locked">
            function <span class="apidocSignatureSpan">hawk.Error.</span>locked
            <span class="apidocSignatureSpan">(message, data)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.hawk.Error.methodNotAllowed">
            function <span class="apidocSignatureSpan">hawk.Error.</span>methodNotAllowed
            <span class="apidocSignatureSpan">(message, data, allow)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.hawk.Error.notAcceptable">
            function <span class="apidocSignatureSpan">hawk.Error.</span>notAcceptable
            <span class="apidocSignatureSpan">(message, data)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.hawk.Error.notFound">
            function <span class="apidocSignatureSpan">hawk.Error.</span>notFound
            <span class="apidocSignatureSpan">(message, data)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.hawk.Error.notImplemented">
            function <span class="apidocSignatureSpan">hawk.Error.</span>notImplemented
            <span class="apidocSignatureSpan">(message, data)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.hawk.Error.paymentRequired">
            function <span class="apidocSignatureSpan">hawk.Error.</span>paymentRequired
            <span class="apidocSignatureSpan">(message, data)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.hawk.Error.preconditionFailed">
            function <span class="apidocSignatureSpan">hawk.Error.</span>preconditionFailed
            <span class="apidocSignatureSpan">(message, data)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.hawk.Error.preconditionRequired">
            function <span class="apidocSignatureSpan">hawk.Error.</span>preconditionRequired
            <span class="apidocSignatureSpan">(message, data)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.hawk.Error.proxyAuthRequired">
            function <span class="apidocSignatureSpan">hawk.Error.</span>proxyAuthRequired
            <span class="apidocSignatureSpan">(message, data)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.hawk.Error.rangeNotSatisfiable">
            function <span class="apidocSignatureSpan">hawk.Error.</span>rangeNotSatisfiable
            <span class="apidocSignatureSpan">(message, data)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.hawk.Error.resourceGone">
            function <span class="apidocSignatureSpan">hawk.Error.</span>resourceGone
            <span class="apidocSignatureSpan">(message, data)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.hawk.Error.serverUnavailable">
            function <span class="apidocSignatureSpan">hawk.Error.</span>serverUnavailable
            <span class="apidocSignatureSpan">(message, data)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.hawk.Error.teapot">
            function <span class="apidocSignatureSpan">hawk.Error.</span>teapot
            <span class="apidocSignatureSpan">(message, data)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.hawk.Error.tooManyRequests">
            function <span class="apidocSignatureSpan">hawk.Error.</span>tooManyRequests
            <span class="apidocSignatureSpan">(message, data)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.hawk.Error.unauthorized">
            function <span class="apidocSignatureSpan">hawk.Error.</span>unauthorized
            <span class="apidocSignatureSpan">(message, scheme, attributes)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.hawk.Error.unsupportedMediaType">
            function <span class="apidocSignatureSpan">hawk.Error.</span>unsupportedMediaType
            <span class="apidocSignatureSpan">(message, data)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.hawk.Error.uriTooLong">
            function <span class="apidocSignatureSpan">hawk.Error.</span>uriTooLong
            <span class="apidocSignatureSpan">(message, data)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.hawk.Error.wrap">
            function <span class="apidocSignatureSpan">hawk.Error.</span>wrap
            <span class="apidocSignatureSpan">(error, statusCode, message)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.hawk.client">module hawk.client</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.hawk.client.authenticate">
            function <span class="apidocSignatureSpan">hawk.client.</span>authenticate
            <span class="apidocSignatureSpan">(res, credentials, artifacts, options, callback)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.hawk.client.getBewit">
            function <span class="apidocSignatureSpan">hawk.client.</span>getBewit
            <span class="apidocSignatureSpan">(uri, options)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.hawk.client.header">
            function <span class="apidocSignatureSpan">hawk.client.</span>header
            <span class="apidocSignatureSpan">(uri, method, options)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.hawk.client.message">
            function <span class="apidocSignatureSpan">hawk.client.</span>message
            <span class="apidocSignatureSpan">(host, port, message, options)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.hawk.crypto">module hawk.crypto</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.hawk.crypto.calculateMac">
            function <span class="apidocSignatureSpan">hawk.crypto.</span>calculateMac
            <span class="apidocSignatureSpan">(type, credentials, options)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.hawk.crypto.calculatePayloadHash">
            function <span class="apidocSignatureSpan">hawk.crypto.</span>calculatePayloadHash
            <span class="apidocSignatureSpan">(payload, algorithm, contentType)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.hawk.crypto.calculateTsMac">
            function <span class="apidocSignatureSpan">hawk.crypto.</span>calculateTsMac
            <span class="apidocSignatureSpan">(ts, credentials)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.hawk.crypto.finalizePayloadHash">
            function <span class="apidocSignatureSpan">hawk.crypto.</span>finalizePayloadHash
            <span class="apidocSignatureSpan">(hash)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.hawk.crypto.generateNormalizedString">
            function <span class="apidocSignatureSpan">hawk.crypto.</span>generateNormalizedString
            <span class="apidocSignatureSpan">(type, options)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.hawk.crypto.initializePayloadHash">
            function <span class="apidocSignatureSpan">hawk.crypto.</span>initializePayloadHash
            <span class="apidocSignatureSpan">(algorithm, contentType)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.hawk.crypto.timestampMessage">
            function <span class="apidocSignatureSpan">hawk.crypto.</span>timestampMessage
            <span class="apidocSignatureSpan">(credentials, localtimeOffsetMsec)</span>
            </a>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">hawk.crypto.</span>algorithms</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">string <span class="apidocSignatureSpan">hawk.crypto.</span>headerVersion</span>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.hawk.server">module hawk.server</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.hawk.server.authenticate">
            function <span class="apidocSignatureSpan">hawk.server.</span>authenticate
            <span class="apidocSignatureSpan">(req, credentialsFunc, options, callback)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.hawk.server.authenticateBewit">
            function <span class="apidocSignatureSpan">hawk.server.</span>authenticateBewit
            <span class="apidocSignatureSpan">(req, credentialsFunc, options, callback)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.hawk.server.authenticateMessage">
            function <span class="apidocSignatureSpan">hawk.server.</span>authenticateMessage
            <span class="apidocSignatureSpan">(host, port, message, authorization, credentialsFunc, options, callback)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.hawk.server.authenticatePayload">
            function <span class="apidocSignatureSpan">hawk.server.</span>authenticatePayload
            <span class="apidocSignatureSpan">(payload, credentials, artifacts, contentType)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.hawk.server.authenticatePayloadHash">
            function <span class="apidocSignatureSpan">hawk.server.</span>authenticatePayloadHash
            <span class="apidocSignatureSpan">(calculatedHash, artifacts)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.hawk.server.header">
            function <span class="apidocSignatureSpan">hawk.server.</span>header
            <span class="apidocSignatureSpan">(credentials, artifacts, options)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.hawk.sntp">module hawk.sntp</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.hawk.sntp.isLive">
            function <span class="apidocSignatureSpan">hawk.sntp.</span>isLive
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.hawk.sntp.now">
            function <span class="apidocSignatureSpan">hawk.sntp.</span>now
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.hawk.sntp.offset">
            function <span class="apidocSignatureSpan">hawk.sntp.</span>offset
            <span class="apidocSignatureSpan">(options, callback)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.hawk.sntp.start">
            function <span class="apidocSignatureSpan">hawk.sntp.</span>start
            <span class="apidocSignatureSpan">(options, callback)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.hawk.sntp.stop">
            function <span class="apidocSignatureSpan">hawk.sntp.</span>stop
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.hawk.sntp.time">
            function <span class="apidocSignatureSpan">hawk.sntp.</span>time
            <span class="apidocSignatureSpan">(options, callback)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.hawk.uri">module hawk.uri</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.hawk.uri.authenticate">
            function <span class="apidocSignatureSpan">hawk.uri.</span>authenticate
            <span class="apidocSignatureSpan">(req, credentialsFunc, options, callback)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.hawk.uri.getBewit">
            function <span class="apidocSignatureSpan">hawk.uri.</span>getBewit
            <span class="apidocSignatureSpan">(uri, options)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.hawk.utils">module hawk.utils</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.hawk.utils.now">
            function <span class="apidocSignatureSpan">hawk.utils.</span>now
            <span class="apidocSignatureSpan">(localtimeOffsetMsec)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.hawk.utils.nowSecs">
            function <span class="apidocSignatureSpan">hawk.utils.</span>nowSecs
            <span class="apidocSignatureSpan">(localtimeOffsetMsec)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.hawk.utils.parseAuthorizationHeader">
            function <span class="apidocSignatureSpan">hawk.utils.</span>parseAuthorizationHeader
            <span class="apidocSignatureSpan">(header, keys)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.hawk.utils.parseContentType">
            function <span class="apidocSignatureSpan">hawk.utils.</span>parseContentType
            <span class="apidocSignatureSpan">(header)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.hawk.utils.parseHost">
            function <span class="apidocSignatureSpan">hawk.utils.</span>parseHost
            <span class="apidocSignatureSpan">(req, hostHeaderName)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.hawk.utils.parseRequest">
            function <span class="apidocSignatureSpan">hawk.utils.</span>parseRequest
            <span class="apidocSignatureSpan">(req, options)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.hawk.utils.unauthorized">
            function <span class="apidocSignatureSpan">hawk.utils.</span>unauthorized
            <span class="apidocSignatureSpan">(message, attributes)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.hawk.utils.version">
            function <span class="apidocSignatureSpan">hawk.utils.</span>version
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">hawk.utils.</span>limits</span>

        </li>

    </ol></li>

</ol></div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.hawk" id="apidoc.module.hawk">module hawk</a></h1>

















</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.hawk.Error" id="apidoc.module.hawk.Error">module hawk.Error</a></h1>


    <h2>
        <a href="#apidoc.element.hawk.Error.badData" id="apidoc.element.hawk.Error.badData">
        function <span class="apidocSignatureSpan">hawk.Error.</span>badData
        <span class="apidocSignatureSpan">(message, data)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">badData = function (message, data) {

    return internals.create(422, message, data, exports.badData);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.hawk.Error.badGateway" id="apidoc.element.hawk.Error.badGateway">
        function <span class="apidocSignatureSpan">hawk.Error.</span>badGateway
        <span class="apidocSignatureSpan">(message, data)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">badGateway = function (message, data) {

    return internals.serverError(message, data, 502, exports.badGateway);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.hawk.Error.badImplementation" id="apidoc.element.hawk.Error.badImplementation">
        function <span class="apidocSignatureSpan">hawk.Error.</span>badImplementation
        <span class="apidocSignatureSpan">(message, data)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">badImplementation = function (message, data) {

    const err = internals.serverError(message, data, 500, exports.badImplementation);
    err.isDeveloperError = true;
    return err;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.hawk.Error.badRequest" id="apidoc.element.hawk.Error.badRequest">
        function <span class="apidocSignatureSpan">hawk.Error.</span>badRequest
        <span class="apidocSignatureSpan">(message, data)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">badRequest = function (message, data) {

    return internals.create(400, message, data, exports.badRequest);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.hawk.Error.clientTimeout" id="apidoc.element.hawk.Error.clientTimeout">
        function <span class="apidocSignatureSpan">hawk.Error.</span>clientTimeout
        <span class="apidocSignatureSpan">(message, data)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">clientTimeout = function (message, data) {

    return internals.create(408, message, data, exports.clientTimeout);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.hawk.Error.conflict" id="apidoc.element.hawk.Error.conflict">
        function <span class="apidocSignatureSpan">hawk.Error.</span>conflict
        <span class="apidocSignatureSpan">(message, data)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">conflict = function (message, data) {

    return internals.create(409, message, data, exports.conflict);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.hawk.Error.create" id="apidoc.element.hawk.Error.create">
        function <span class="apidocSignatureSpan">hawk.Error.</span>create
        <span class="apidocSignatureSpan">(statusCode, message, data)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">create = function (statusCode, message, data) {

    return internals.create(statusCode, message, data, exports.create);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    }

    return normalized;
},

calculatePayloadHash: function (payload, algorithm, contentType) {

    const hash = CryptoJS.algo[algorithm.toUpperCase()].<span class="apidocCodeKeywordSpan">create</span>();
    hash.update(&#x27;hawk.&#x27; + hawk.crypto.headerVersion + &#x27;.payload\n&#x27;);
    hash.update(hawk.utils.parseContentType(contentType) + &#x27;\n&#x27;);
    hash.update(payload);
    hash.update(&#x27;\n&#x27;);
    return hash.finalize().toString(CryptoJS.enc.Base64);
},
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.hawk.Error.entityTooLarge" id="apidoc.element.hawk.Error.entityTooLarge">
        function <span class="apidocSignatureSpan">hawk.Error.</span>entityTooLarge
        <span class="apidocSignatureSpan">(message, data)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">entityTooLarge = function (message, data) {

    return internals.create(413, message, data, exports.entityTooLarge);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.hawk.Error.expectationFailed" id="apidoc.element.hawk.Error.expectationFailed">
        function <span class="apidocSignatureSpan">hawk.Error.</span>expectationFailed
        <span class="apidocSignatureSpan">(message, data)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">expectationFailed = function (message, data) {

    return internals.create(417, message, data, exports.expectationFailed);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.hawk.Error.forbidden" id="apidoc.element.hawk.Error.forbidden">
        function <span class="apidocSignatureSpan">hawk.Error.</span>forbidden
        <span class="apidocSignatureSpan">(message, data)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">forbidden = function (message, data) {

    return internals.create(403, message, data, exports.forbidden);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.hawk.Error.gatewayTimeout" id="apidoc.element.hawk.Error.gatewayTimeout">
        function <span class="apidocSignatureSpan">hawk.Error.</span>gatewayTimeout
        <span class="apidocSignatureSpan">(message, data)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">gatewayTimeout = function (message, data) {

    return internals.serverError(message, data, 504, exports.gatewayTimeout);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.hawk.Error.illegal" id="apidoc.element.hawk.Error.illegal">
        function <span class="apidocSignatureSpan">hawk.Error.</span>illegal
        <span class="apidocSignatureSpan">(message, data)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">illegal = function (message, data) {

    return internals.create(451, message, data, exports.illegal);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.hawk.Error.internal" id="apidoc.element.hawk.Error.internal">
        function <span class="apidocSignatureSpan">hawk.Error.</span>internal
        <span class="apidocSignatureSpan">(message, data, statusCode)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">internal = function (message, data, statusCode) {

    return internals.serverError(message, data, statusCode, exports.internal);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.hawk.Error.lengthRequired" id="apidoc.element.hawk.Error.lengthRequired">
        function <span class="apidocSignatureSpan">hawk.Error.</span>lengthRequired
        <span class="apidocSignatureSpan">(message, data)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">lengthRequired = function (message, data) {

    return internals.create(411, message, data, exports.lengthRequired);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.hawk.Error.locked" id="apidoc.element.hawk.Error.locked">
        function <span class="apidocSignatureSpan">hawk.Error.</span>locked
        <span class="apidocSignatureSpan">(message, data)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">locked = function (message, data) {

    return internals.create(423, message, data, exports.locked);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.hawk.Error.methodNotAllowed" id="apidoc.element.hawk.Error.methodNotAllowed">
        function <span class="apidocSignatureSpan">hawk.Error.</span>methodNotAllowed
        <span class="apidocSignatureSpan">(message, data, allow)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">methodNotAllowed = function (message, data, allow) {

    const err = internals.create(405, message, data, exports.methodNotAllowed);

    if (typeof allow === &#x27;string&#x27;) {
        allow = [allow];
    }

    if (Array.isArray(allow)) {
        err.output.headers.Allow = allow.join(&#x27;, &#x27;);
    }

    return err;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.hawk.Error.notAcceptable" id="apidoc.element.hawk.Error.notAcceptable">
        function <span class="apidocSignatureSpan">hawk.Error.</span>notAcceptable
        <span class="apidocSignatureSpan">(message, data)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">notAcceptable = function (message, data) {

    return internals.create(406, message, data, exports.notAcceptable);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.hawk.Error.notFound" id="apidoc.element.hawk.Error.notFound">
        function <span class="apidocSignatureSpan">hawk.Error.</span>notFound
        <span class="apidocSignatureSpan">(message, data)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">notFound = function (message, data) {

    return internals.create(404, message, data, exports.notFound);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.hawk.Error.notImplemented" id="apidoc.element.hawk.Error.notImplemented">
        function <span class="apidocSignatureSpan">hawk.Error.</span>notImplemented
        <span class="apidocSignatureSpan">(message, data)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">notImplemented = function (message, data) {

    return internals.serverError(message, data, 501, exports.notImplemented);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.hawk.Error.paymentRequired" id="apidoc.element.hawk.Error.paymentRequired">
        function <span class="apidocSignatureSpan">hawk.Error.</span>paymentRequired
        <span class="apidocSignatureSpan">(message, data)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">paymentRequired = function (message, data) {

    return internals.create(402, message, data, exports.paymentRequired);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.hawk.Error.preconditionFailed" id="apidoc.element.hawk.Error.preconditionFailed">
        function <span class="apidocSignatureSpan">hawk.Error.</span>preconditionFailed
        <span class="apidocSignatureSpan">(message, data)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">preconditionFailed = function (message, data) {

    return internals.create(412, message, data, exports.preconditionFailed);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.hawk.Error.preconditionRequired" id="apidoc.element.hawk.Error.preconditionRequired">
        function <span class="apidocSignatureSpan">hawk.Error.</span>preconditionRequired
        <span class="apidocSignatureSpan">(message, data)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">preconditionRequired = function (message, data) {

    return internals.create(428, message, data, exports.preconditionRequired);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.hawk.Error.proxyAuthRequired" id="apidoc.element.hawk.Error.proxyAuthRequired">
        function <span class="apidocSignatureSpan">hawk.Error.</span>proxyAuthRequired
        <span class="apidocSignatureSpan">(message, data)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">proxyAuthRequired = function (message, data) {

    return internals.create(407, message, data, exports.proxyAuthRequired);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.hawk.Error.rangeNotSatisfiable" id="apidoc.element.hawk.Error.rangeNotSatisfiable">
        function <span class="apidocSignatureSpan">hawk.Error.</span>rangeNotSatisfiable
        <span class="apidocSignatureSpan">(message, data)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">rangeNotSatisfiable = function (message, data) {

    return internals.create(416, message, data, exports.rangeNotSatisfiable);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.hawk.Error.resourceGone" id="apidoc.element.hawk.Error.resourceGone">
        function <span class="apidocSignatureSpan">hawk.Error.</span>resourceGone
        <span class="apidocSignatureSpan">(message, data)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">resourceGone = function (message, data) {

    return internals.create(410, message, data, exports.resourceGone);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.hawk.Error.serverUnavailable" id="apidoc.element.hawk.Error.serverUnavailable">
        function <span class="apidocSignatureSpan">hawk.Error.</span>serverUnavailable
        <span class="apidocSignatureSpan">(message, data)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">serverUnavailable = function (message, data) {

    return internals.serverError(message, data, 503, exports.serverUnavailable);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.hawk.Error.teapot" id="apidoc.element.hawk.Error.teapot">
        function <span class="apidocSignatureSpan">hawk.Error.</span>teapot
        <span class="apidocSignatureSpan">(message, data)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">teapot = function (message, data) {

    return internals.create(418, message, data, exports.teapot);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.hawk.Error.tooManyRequests" id="apidoc.element.hawk.Error.tooManyRequests">
        function <span class="apidocSignatureSpan">hawk.Error.</span>tooManyRequests
        <span class="apidocSignatureSpan">(message, data)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">tooManyRequests = function (message, data) {

    return internals.create(429, message, data, exports.tooManyRequests);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.hawk.Error.unauthorized" id="apidoc.element.hawk.Error.unauthorized">
        function <span class="apidocSignatureSpan">hawk.Error.</span>unauthorized
        <span class="apidocSignatureSpan">(message, scheme, attributes)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">unauthorized = function (message, scheme, attributes) {          // Or function (message, wwwAuthenticate[])

    const err = internals.create(401, message, undefined, exports.unauthorized);

    if (!scheme) {
        return err;
    }

    let wwwAuthenticate = &#x27;&#x27;;

    if (typeof scheme === &#x27;string&#x27;) {

        // function (message, scheme, attributes)

        wwwAuthenticate = scheme;

        if (attributes || message) {
            err.output.payload.attributes = {};
        }

        if (attributes) {
            if (typeof attributes === &#x27;string&#x27;) {
                wwwAuthenticate = wwwAuthenticate + &#x27; &#x27; + Hoek.escapeHeaderAttribute(attributes);
                err.output.payload.attributes = attributes;
            }
            else {
                const names = Object.keys(attributes);
                for (let i = 0; i &#x3c; names.length; ++i) {
                    const name = names[i];
                    if (i) {
                        wwwAuthenticate = wwwAuthenticate + &#x27;,&#x27;;
                    }

                    let value = attributes[name];
                    if (value === null ||
                        value === undefined) {              // Value can be zero

                        value = &#x27;&#x27;;
                    }
                    wwwAuthenticate = wwwAuthenticate + &#x27; &#x27; + name + &#x27;=&#x22;&#x27; + Hoek.escapeHeaderAttribute(value.toString()) + &#x27;&#x22;&#x27;;
                    err.output.payload.attributes[name] = value;
                }
            }
        }


        if (message) {
            if (attributes) {
                wwwAuthenticate = wwwAuthenticate + &#x27;,&#x27;;
            }
            wwwAuthenticate = wwwAuthenticate + &#x27; error=&#x22;&#x27; + Hoek.escapeHeaderAttribute(message) + &#x27;&#x22;&#x27;;
            err.output.payload.attributes.error = message;
        }
        else {
            err.isMissing = true;
        }
    }
    else {

        // function (message, wwwAuthenticate[])

        const wwwArray = scheme;
        for (let i = 0; i &#x3c; wwwArray.length; ++i) {
            if (i) {
                wwwAuthenticate = wwwAuthenticate + &#x27;, &#x27;;
            }

            wwwAuthenticate = wwwAuthenticate + wwwArray[i];
        }
    }

    err.output.headers[&#x27;WWW-Authenticate&#x27;] = wwwAuthenticate;

    return err;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.hawk.Error.unsupportedMediaType" id="apidoc.element.hawk.Error.unsupportedMediaType">
        function <span class="apidocSignatureSpan">hawk.Error.</span>unsupportedMediaType
        <span class="apidocSignatureSpan">(message, data)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">unsupportedMediaType = function (message, data) {

    return internals.create(415, message, data, exports.unsupportedMediaType);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.hawk.Error.uriTooLong" id="apidoc.element.hawk.Error.uriTooLong">
        function <span class="apidocSignatureSpan">hawk.Error.</span>uriTooLong
        <span class="apidocSignatureSpan">(message, data)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">uriTooLong = function (message, data) {

    return internals.create(414, message, data, exports.uriTooLong);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.hawk.Error.wrap" id="apidoc.element.hawk.Error.wrap">
        function <span class="apidocSignatureSpan">hawk.Error.</span>wrap
        <span class="apidocSignatureSpan">(error, statusCode, message)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">wrap = function (error, statusCode, message) {

    Hoek.assert(error instanceof Error, &#x27;Cannot wrap non-Error object&#x27;);
    Hoek.assert(!error.isBoom || (!statusCode &#x26;&#x26; !message), &#x27;Cannot provide statusCode or message with boom error&#x27;);

    return (error.isBoom ? error : internals.initialize(error, statusCode || 500, message));
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.hawk.client" id="apidoc.module.hawk.client">module hawk.client</a></h1>


    <h2>
        <a href="#apidoc.element.hawk.client.authenticate" id="apidoc.element.hawk.client.authenticate">
        function <span class="apidocSignatureSpan">hawk.client.</span>authenticate
        <span class="apidocSignatureSpan">(res, credentials, artifacts, options, callback)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">authenticate = function (res, credentials, artifacts, options, callback) {

    artifacts = Hoek.clone(artifacts);
    options = options || {};

    let wwwAttributes = null;
    let serverAuthAttributes = null;

    const finalize = function (err) {

        if (callback) {
            const headers = {
                &#x27;www-authenticate&#x27;: wwwAttributes,
                &#x27;server-authorization&#x27;: serverAuthAttributes
            };

            return callback(err, headers);
        }

        return !err;
    };

    if (res.headers[&#x27;www-authenticate&#x27;]) {

        // Parse HTTP WWW-Authenticate header

        wwwAttributes = Utils.parseAuthorizationHeader(res.headers[&#x27;www-authenticate&#x27;], [&#x27;ts&#x27;, &#x27;tsm&#x27;, &#x27;error&#x27;]);
        if (wwwAttributes instanceof Error) {
            wwwAttributes = null;
            return finalize(new Error(&#x27;Invalid WWW-Authenticate header&#x27;));
        }

        // Validate server timestamp (not used to update clock since it is done via the SNPT client)

        if (wwwAttributes.ts) {
            const tsm = Crypto.calculateTsMac(wwwAttributes.ts, credentials);
            if (tsm !== wwwAttributes.tsm) {
                return finalize(new Error(&#x27;Invalid server timestamp hash&#x27;));
            }
        }
    }

    // Parse HTTP Server-Authorization header

    if (!res.headers[&#x27;server-authorization&#x27;] &#x26;&#x26;
        !options.required) {

        return finalize();
    }

    serverAuthAttributes = Utils.parseAuthorizationHeader(res.headers[&#x27;server-authorization&#x27;], [&#x27;mac&#x27;, &#x27;ext&#x27;, &#x27;hash&#x27;]);
    if (serverAuthAttributes instanceof Error) {
        serverAuthAttributes = null;
        return finalize(new Error(&#x27;Invalid Server-Authorization header&#x27;));
    }

    artifacts.ext = serverAuthAttributes.ext;
    artifacts.hash = serverAuthAttributes.hash;

    const mac = Crypto.calculateMac(&#x27;response&#x27;, credentials, artifacts);
    if (mac !== serverAuthAttributes.mac) {
        return finalize(new Error(&#x27;Bad response mac&#x27;));
    }

    if (!options.payload &#x26;&#x26;
        options.payload !== &#x27;&#x27;) {

        return finalize();
    }

    if (!serverAuthAttributes.hash) {
        return finalize(new Error(&#x27;Missing response hash attribute&#x27;));
    }

    const calculatedHash = Crypto.calculatePayloadHash(options.payload, credentials.algorithm, res.headers[&#x27;content-type&#x27;]);
    if (calculatedHash !== serverAuthAttributes.hash) {
        return finalize(new Error(&#x27;Bad response payload mac&#x27;));
    }

    return finalize();
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

// Create HTTP server

const handler = function (req, res) {

    // Authenticate incoming request

    Hawk.server.<span class="apidocCodeKeywordSpan">authenticate</span>(req, credentialsFunc, {}, (err, credentials, artifacts) =&#
x3e; {

// Prepare response

const payload = (!err ? `Hello ${credentials.user} ${artifacts.ext}` : &#x27;Shoosh!&#x27;);
const headers = { &#x27;Content-Type&#x27;: &#x27;text/plain&#x27; };

// Generate Server-Authorization response header
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.hawk.client.getBewit" id="apidoc.element.hawk.client.getBewit">
        function <span class="apidocSignatureSpan">hawk.client.</span>getBewit
        <span class="apidocSignatureSpan">(uri, options)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">getBewit = function (uri, options) {

    // Validate inputs

    if (!uri ||
        (typeof uri !== &#x27;string&#x27; &#x26;&#x26; typeof uri !== &#x27;object&#x27;) ||
        !options ||
        typeof options !== &#x27;object&#x27; ||
        !options.ttlSec) {

        return &#x27;&#x27;;
    }

    options.ext = (options.ext === null || options.ext === undefined ? &#x27;&#x27; : options.ext);       // Zero is valid value

    // Application time

    const now = Utils.now(options.localtimeOffsetMsec);

    // Validate credentials

    const credentials = options.credentials;
    if (!credentials ||
        !credentials.id ||
        !credentials.key ||
        !credentials.algorithm) {

        return &#x27;&#x27;;
    }

    if (Crypto.algorithms.indexOf(credentials.algorithm) === -1) {
        return &#x27;&#x27;;
    }

    // Parse URI

    if (typeof uri === &#x27;string&#x27;) {
        uri = Url.parse(uri);
    }

    // Calculate signature

    const exp = Math.floor(now / 1000) + options.ttlSec;
    const mac = Crypto.calculateMac(&#x27;bewit&#x27;, credentials, {
        ts: exp,
        nonce: &#x27;&#x27;,
        method: &#x27;GET&#x27;,
        resource: uri.pathname + (uri.search || &#x27;&#x27;),                            // Maintain trailing &#x27;?&#x27;
        host: uri.hostname,
        port: uri.port || (uri.protocol === &#x27;http:&#x27; ? 80 : 443),
        ext: options.ext
    });

    // Construct bewit: id\exp\mac\ext

    const bewit = credentials.id + &#x27;\\&#x27; + exp + &#x27;\\&#x27; + mac + &#x27;\\&#x27; + options.ext;
    return Hoek.base64urlEncode(bewit);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    key: &#x27;werxhqb98rpaxn39848xrunpaw3489ruxnpa98w4rxn&#x27;,
    algorithm: &#x27;sha256&#x27;
}

// Generate bewit

const duration = 60 * 5;      // 5 Minutes
const bewit = Hawk.uri.<span class="apidocCodeKeywordSpan">getBewit</span>(&#x27;http://example.com:8000/resource/1?b=1&#x26;a=2
&#x27;, { credentials: credentials, ttlSec: duration, ext: &#x27;some-app-data&#x27; });
const uri = &#x27;http://example.com:8000/resource/1?b=1&#x26;a=2&#x27; + &#x27;&#x26;bewit=&#x27; + bewit;

// Output URI

console.log(&#x27;URI: &#x27; + uri);
```
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.hawk.client.header" id="apidoc.element.hawk.client.header">
        function <span class="apidocSignatureSpan">hawk.client.</span>header
        <span class="apidocSignatureSpan">(uri, method, options)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">header = function (uri, method, options) {

    const result = {
        field: &#x27;&#x27;,
        artifacts: {}
    };

    // Validate inputs

    if (!uri || (typeof uri !== &#x27;string&#x27; &#x26;&#x26; typeof uri !== &#x27;object&#x27;) ||
        !method || typeof method !== &#x27;string&#x27; ||
        !options || typeof options !== &#x27;object&#x27;) {

        result.err = &#x27;Invalid argument type&#x27;;
        return result;
    }

    // Application time

    const timestamp = options.timestamp || Utils.nowSecs(options.localtimeOffsetMsec);

    // Validate credentials

    const credentials = options.credentials;
    if (!credentials ||
        !credentials.id ||
        !credentials.key ||
        !credentials.algorithm) {

        result.err = &#x27;Invalid credential object&#x27;;
        return result;
    }

    if (Crypto.algorithms.indexOf(credentials.algorithm) === -1) {
        result.err = &#x27;Unknown algorithm&#x27;;
        return result;
    }

    // Parse URI

    if (typeof uri === &#x27;string&#x27;) {
        uri = Url.parse(uri);
    }

    // Calculate signature

    const artifacts = {
        ts: timestamp,
        nonce: options.nonce || Cryptiles.randomString(6),
        method,
        resource: uri.pathname + (uri.search || &#x27;&#x27;),                            // Maintain trailing &#x27;?&#x27;
        host: uri.hostname,
        port: uri.port || (uri.protocol === &#x27;http:&#x27; ? 80 : 443),
        hash: options.hash,
        ext: options.ext,
        app: options.app,
        dlg: options.dlg
    };

    result.artifacts = artifacts;

    // Calculate payload hash

    if (!artifacts.hash &#x26;&#x26;
        (options.payload || options.payload === &#x27;&#x27;)) {

        artifacts.hash = Crypto.calculatePayloadHash(options.payload, credentials.algorithm, options.contentType);
    }

    const mac = Crypto.calculateMac(&#x27;header&#x27;, credentials, artifacts);

    // Construct header

    const hasExt = artifacts.ext !== null &#x26;&#x26; artifacts.ext !== undefined &#x26;&#x26; artifacts.ext !== &#x27;&#x27;;       // Other falsey values allowed
    let header = &#x27;Hawk id=&#x22;&#x27; + credentials.id +
                 &#x27;&#x22;, ts=&#x22;&#x27; + artifacts.ts +
                 &#x27;&#x22;, nonce=&#x22;&#x27; + artifacts.nonce +
                 (artifacts.hash ? &#x27;&#x22;, hash=&#x22;&#x27; + artifacts.hash : &#x27;&#x27;) +
                 (hasExt ? &#x27;&#x22;, ext=&#x22;&#x27; + Hoek.escapeHeaderAttribute(artifacts.ext) : &#x27;&#x27;) +
                 &#x27;&#x22;, mac=&#x22;&#x27; + mac + &#x27;&#x22;&#x27;;

    if (artifacts.app) {
        header = header + &#x27;, app=&#x22;&#x27; + artifacts.app +
                  (artifacts.dlg ? &#x27;&#x22;, dlg=&#x22;&#x27; + artifacts.dlg : &#x27;&#x27;) + &#x27;&#x22;&#x27;;
    }

    result.field = header;

    return result;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    // Prepare response

    const payload = (!err ? `Hello ${credentials.user} ${artifacts.ext}` : &#x27;Shoosh!&#x27;);
    const headers = { &#x27;Content-Type&#x27;: &#x27;text/plain&#x27; };

    // Generate Server-Authorization response header

    const header = Hawk.server.<span class="apidocCodeKeywordSpan">header</span>(credentials, artifacts, { payload, contentType:
headers[&#x27;Content-Type&#x27;] });
    headers[&#x27;Server-Authorization&#x27;] = header;

    // Send the response back

    res.writeHead(!err ? 200 : 401, headers);
    res.end(payload);
});
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.hawk.client.message" id="apidoc.element.hawk.client.message">
        function <span class="apidocSignatureSpan">hawk.client.</span>message
        <span class="apidocSignatureSpan">(host, port, message, options)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">message = function (host, port, message, options) {

    // Validate inputs

    if (!host || typeof host !== &#x27;string&#x27; ||
        !port || typeof port !== &#x27;number&#x27; ||
        message === null || message === undefined || typeof message !== &#x27;string&#x27; ||
        !options || typeof options !== &#x27;object&#x27;) {

        return null;
    }

    // Application time

    const timestamp = options.timestamp || Utils.nowSecs(options.localtimeOffsetMsec);

    // Validate credentials

    const credentials = options.credentials;
    if (!credentials ||
        !credentials.id ||
        !credentials.key ||
        !credentials.algorithm) {

        // Invalid credential object
        return null;
    }

    if (Crypto.algorithms.indexOf(credentials.algorithm) === -1) {
        return null;
    }

    // Calculate signature

    const artifacts = {
        ts: timestamp,
        nonce: options.nonce || Cryptiles.randomString(6),
        host,
        port,
        hash: Crypto.calculatePayloadHash(message, credentials.algorithm)
    };

    // Construct authorization

    const result = {
        id: credentials.id,
        ts: artifacts.ts,
        nonce: artifacts.nonce,
        hash: artifacts.hash,
        mac: Crypto.calculateMac(&#x27;message&#x27;, credentials, artifacts)
    };

    return result;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.hawk.crypto" id="apidoc.module.hawk.crypto">module hawk.crypto</a></h1>


    <h2>
        <a href="#apidoc.element.hawk.crypto.calculateMac" id="apidoc.element.hawk.crypto.calculateMac">
        function <span class="apidocSignatureSpan">hawk.crypto.</span>calculateMac
        <span class="apidocSignatureSpan">(type, credentials, options)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">calculateMac = function (type, credentials, options) {

    const normalized = exports.generateNormalizedString(type, options);

    const hmac = Crypto.createHmac(credentials.algorithm, credentials.key).update(normalized);
    const digest = hmac.digest(&#x27;base64&#x27;);
    return digest;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

if (!artifacts.hash &#x26;&#x26;
    (options.payload || options.payload === &#x27;&#x27;)) {

    artifacts.hash = hawk.crypto.calculatePayloadHash(options.payload, credentials.algorithm, options.contentType);
}

const mac = hawk.crypto.<span class="apidocCodeKeywordSpan">calculateMac</span>(&#x27;header&#x27;, credentials, artifacts);

// Construct header

const hasExt = artifacts.ext !== null &#x26;&#x26; artifacts.ext !== undefined &#x26;&#x26; artifacts.ext !== &#x27;&#x27;;       //
Other falsey values allowed
let header = &#x27;Hawk id=&#x22;&#x27; + credentials.id +
             &#x27;&#x22;, ts=&#x22;&#x27; + artifacts.ts +
             &#x27;&#x22;, nonce=&#x22;&#x27; + artifacts.nonce +
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.hawk.crypto.calculatePayloadHash" id="apidoc.element.hawk.crypto.calculatePayloadHash">
        function <span class="apidocSignatureSpan">hawk.crypto.</span>calculatePayloadHash
        <span class="apidocSignatureSpan">(payload, algorithm, contentType)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">calculatePayloadHash = function (payload, algorithm, contentType) {

    const hash = exports.initializePayloadHash(algorithm, contentType);
    hash.update(payload || &#x27;&#x27;);
    return exports.finalizePayloadHash(hash);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
result.artifacts = artifacts;

// Calculate payload hash

if (!artifacts.hash &#x26;&#x26;
    (options.payload || options.payload === &#x27;&#x27;)) {

    artifacts.hash = hawk.crypto.<span class="apidocCodeKeywordSpan">calculatePayloadHash</span>(options.payload, credentials.algorithm
, options.contentType);
}

const mac = hawk.crypto.calculateMac(&#x27;header&#x27;, credentials, artifacts);

// Construct header

const hasExt = artifacts.ext !== null &#x26;&#x26; artifacts.ext !== undefined &#x26;&#x26; artifacts.ext !== &#x27;&#x27;;       //
Other falsey values allowed
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.hawk.crypto.calculateTsMac" id="apidoc.element.hawk.crypto.calculateTsMac">
        function <span class="apidocSignatureSpan">hawk.crypto.</span>calculateTsMac
        <span class="apidocSignatureSpan">(ts, credentials)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">calculateTsMac = function (ts, credentials) {

    const hmac = Crypto.createHmac(credentials.algorithm, credentials.key);
    hmac.update(&#x27;hawk.&#x27; + exports.headerVersion + &#x27;.ts\n&#x27; + ts + &#x27;\n&#x27;);
    return hmac.digest(&#x27;base64&#x27;);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

    const wwwAttributes = hawk.utils.parseAuthorizationHeader(wwwAuthenticate, [&#x27;ts&#x27;, &#x27;tsm&#x27;, &#x27;error&#x27
;]);
    if (!wwwAttributes) {
        return false;
    }

    if (wwwAttributes.ts) {
        const tsm = hawk.crypto.<span class="apidocCodeKeywordSpan">calculateTsMac</span>(wwwAttributes.ts, credentials);
        if (tsm !== wwwAttributes.tsm) {
            return false;
        }

        hawk.utils.setNtpSecOffset(wwwAttributes.ts - Math.floor(Date.now() / 1000));      // Keep offset at 1 second precision
    }
}
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.hawk.crypto.finalizePayloadHash" id="apidoc.element.hawk.crypto.finalizePayloadHash">
        function <span class="apidocSignatureSpan">hawk.crypto.</span>finalizePayloadHash
        <span class="apidocSignatureSpan">(hash)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">finalizePayloadHash = function (hash) {

    hash.update(&#x27;\n&#x27;);
    return hash.digest(&#x27;base64&#x27;);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.hawk.crypto.generateNormalizedString" id="apidoc.element.hawk.crypto.generateNormalizedString">
        function <span class="apidocSignatureSpan">hawk.crypto.</span>generateNormalizedString
        <span class="apidocSignatureSpan">(type, options)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">generateNormalizedString = function (type, options) {

    let resource = options.resource || &#x27;&#x27;;
    if (resource &#x26;&#x26;
        resource[0] !== &#x27;/&#x27;) {

        const url = Url.parse(resource, false);
        resource = url.path;                        // Includes query
    }

    let normalized = &#x27;hawk.&#x27; + exports.headerVersion + &#x27;.&#x27; + type + &#x27;\n&#x27; +
                     options.ts + &#x27;\n&#x27; +
                     options.nonce + &#x27;\n&#x27; +
                     (options.method || &#x27;&#x27;).toUpperCase() + &#x27;\n&#x27; +
                     resource + &#x27;\n&#x27; +
                     options.host.toLowerCase() + &#x27;\n&#x27; +
                     options.port + &#x27;\n&#x27; +
                     (options.hash || &#x27;&#x27;) + &#x27;\n&#x27;;

    if (options.ext) {
        normalized = normalized + options.ext.replace(&#x27;\\&#x27;, &#x27;\\\\&#x27;).replace(&#x27;\n&#x27;, &#x27;\\n&#x27;);
    }

    normalized = normalized + &#x27;\n&#x27;;

    if (options.app) {
        normalized = normalized + options.app + &#x27;\n&#x27; +
                                  (options.dlg || &#x27;&#x27;) + &#x27;\n&#x27;;
    }

    return normalized;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

headerVersion: &#x27;1&#x27;,

algorithms: [&#x27;sha1&#x27;, &#x27;sha256&#x27;],

calculateMac: function (type, credentials, options) {

    const normalized = hawk.crypto.<span class="apidocCodeKeywordSpan">generateNormalizedString</span>(type, options);

    const hmac = CryptoJS[&#x27;Hmac&#x27; + credentials.algorithm.toUpperCase()](normalized, credentials.key);
    return hmac.toString(CryptoJS.enc.Base64);
},

generateNormalizedString: function (type, options) {
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.hawk.crypto.initializePayloadHash" id="apidoc.element.hawk.crypto.initializePayloadHash">
        function <span class="apidocSignatureSpan">hawk.crypto.</span>initializePayloadHash
        <span class="apidocSignatureSpan">(algorithm, contentType)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">initializePayloadHash = function (algorithm, contentType) {

    const hash = Crypto.createHash(algorithm);
    hash.update(&#x27;hawk.&#x27; + exports.headerVersion + &#x27;.payload\n&#x27;);
    hash.update(Utils.parseContentType(contentType) + &#x27;\n&#x27;);
    return hash;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.hawk.crypto.timestampMessage" id="apidoc.element.hawk.crypto.timestampMessage">
        function <span class="apidocSignatureSpan">hawk.crypto.</span>timestampMessage
        <span class="apidocSignatureSpan">(credentials, localtimeOffsetMsec)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">timestampMessage = function (credentials, localtimeOffsetMsec) {

    const now = Utils.nowSecs(localtimeOffsetMsec);
    const tsm = exports.calculateTsMac(now, credentials);
    return { ts: now, tsm };
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>






</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.hawk.server" id="apidoc.module.hawk.server">module hawk.server</a></h1>


    <h2>
        <a href="#apidoc.element.hawk.server.authenticate" id="apidoc.element.hawk.server.authenticate">
        function <span class="apidocSignatureSpan">hawk.server.</span>authenticate
        <span class="apidocSignatureSpan">(req, credentialsFunc, options, callback)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">authenticate = function (req, credentialsFunc, options, callback) {

    callback = Hoek.nextTick(callback);

    // Default options

    options.nonceFunc = options.nonceFunc || internals.nonceFunc;
    options.timestampSkewSec = options.timestampSkewSec || 60;                                                  // 60 seconds

    // Application time

    const now = Utils.now(options.localtimeOffsetMsec);                           // Measure now before any other processing

    // Convert node Http request object to a request configuration object

    const request = Utils.parseRequest(req, options);
    if (request instanceof Error) {
        return callback(Boom.badRequest(request.message));
    }

    // Parse HTTP Authorization header

    const attributes = Utils.parseAuthorizationHeader(request.authorization);
    if (attributes instanceof Error) {
        return callback(attributes);
    }

    // Construct artifacts container

    const artifacts = {
        method: request.method,
        host: request.host,
        port: request.port,
        resource: request.url,
        ts: attributes.ts,
        nonce: attributes.nonce,
        hash: attributes.hash,
        ext: attributes.ext,
        app: attributes.app,
        dlg: attributes.dlg,
        mac: attributes.mac,
        id: attributes.id
    };

    // Verify required header attributes

    if (!attributes.id ||
        !attributes.ts ||
        !attributes.nonce ||
        !attributes.mac) {

        return callback(Boom.badRequest(&#x27;Missing attributes&#x27;), null, artifacts);
    }

    // Fetch Hawk credentials

    credentialsFunc(attributes.id, (err, credentials) =&#x3e; {

        if (err) {
            return callback(err, credentials || null, artifacts);
        }

        if (!credentials) {
            return callback(Utils.unauthorized(&#x27;Unknown credentials&#x27;), null, artifacts);
        }

        if (!credentials.key ||
            !credentials.algorithm) {

            return callback(Boom.internal(&#x27;Invalid credentials&#x27;), credentials, artifacts);
        }

        if (Crypto.algorithms.indexOf(credentials.algorithm) === -1) {
            return callback(Boom.internal(&#x27;Unknown algorithm&#x27;), credentials, artifacts);
        }

        // Calculate MAC

        const mac = Crypto.calculateMac(&#x27;header&#x27;, credentials, artifacts);
        if (!Cryptiles.fixedTimeComparison(mac, attributes.mac)) {
            return callback(Utils.unauthorized(&#x27;Bad mac&#x27;), credentials, artifacts);
        }

        // Check payload hash

        if (options.payload ||
            options.payload === &#x27;&#x27;) {

            if (!attributes.hash) {
                return callback(Utils.unauthorized(&#x27;Missing required payload hash&#x27;), credentials, artifacts);
            }

            const hash = Crypto.calculatePayloadHash(options.payload, credentials.algorithm, request.contentType);
            if (!Cryptiles.fixedTimeComparison(hash, attributes.hash)) {
                return callback(Utils.unauthorized(&#x27;Bad payload hash&#x27;), credentials, artifacts);
            }
        }

        // Check nonce

        options.nonceFunc(credentials.key, attributes.nonce, attributes.ts, (err) =&#x3e; {

            if (err) {
                return callback(Utils.unauthorized(&#x27;Invalid nonce&#x27;), credentials, artifacts);
            }

            // Check timestamp staleness

            if (Math.abs((attributes.ts * 1000) - now) &#x3e; (options.timestampSkewSec * 1000)) {
                const tsm = Crypto.timestampMessage(credentials, options.localtimeOffsetMsec);
                return callback(Utils.unauthorized(&#x27;Stale timestamp&#x27;, tsm), credentials, artifacts);
            }

            // Successful authentication

            return callback(null, credentials, artifacts);
        });
    });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

// Create HTTP server

const handler = function (req, res) {

    // Authenticate incoming request

    Hawk.server.<span class="apidocCodeKeywordSpan">authenticate</span>(req, credentialsFunc, {}, (err, credentials, artifacts) =&#
x3e; {

// Prepare response

const payload = (!err ? `Hello ${credentials.user} ${artifacts.ext}` : &#x27;Shoosh!&#x27;);
const headers = { &#x27;Content-Type&#x27;: &#x27;text/plain&#x27; };

// Generate Server-Authorization response header
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.hawk.server.authenticateBewit" id="apidoc.element.hawk.server.authenticateBewit">
        function <span class="apidocSignatureSpan">hawk.server.</span>authenticateBewit
        <span class="apidocSignatureSpan">(req, credentialsFunc, options, callback)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">authenticateBewit = function (req, credentialsFunc, options, callback) {

    callback = Hoek.nextTick(callback);

    // Application time

    const now = Utils.now(options.localtimeOffsetMsec);

    // Convert node Http request object to a request configuration object

    const request = Utils.parseRequest(req, options);
    if (request instanceof Error) {
        return callback(Boom.badRequest(request.message));
    }

    // Extract bewit

    if (request.url.length &#x3e; Utils.limits.maxMatchLength) {
        return callback(Boom.badRequest(&#x27;Resource path exceeds max length&#x27;));
    }

    const resource = request.url.match(internals.bewitRegex);
    if (!resource) {
        return callback(Utils.unauthorized());
    }

    // Bewit not empty

    if (!resource[3]) {
        return callback(Utils.unauthorized(&#x27;Empty bewit&#x27;));
    }

    // Verify method is GET

    if (request.method !== &#x27;GET&#x27; &#x26;&#x26;
        request.method !== &#x27;HEAD&#x27;) {

        return callback(Utils.unauthorized(&#x27;Invalid method&#x27;));
    }

    // No other authentication

    if (request.authorization) {
        return callback(Boom.badRequest(&#x27;Multiple authentications&#x27;));
    }

    // Parse bewit

    const bewitString = Hoek.base64urlDecode(resource[3]);
    if (bewitString instanceof Error) {
        return callback(Boom.badRequest(&#x27;Invalid bewit encoding&#x27;));
    }

    // Bewit format: id\exp\mac\ext (&#x27;\&#x27; is used because it is a reserved header attribute character)

    const bewitParts = bewitString.split(&#x27;\\&#x27;);
    if (bewitParts.length !== 4) {
        return callback(Boom.badRequest(&#x27;Invalid bewit structure&#x27;));
    }

    const bewit = {
        id: bewitParts[0],
        exp: parseInt(bewitParts[1], 10),
        mac: bewitParts[2],
        ext: bewitParts[3] || &#x27;&#x27;
    };

    if (!bewit.id ||
        !bewit.exp ||
        !bewit.mac) {

        return callback(Boom.badRequest(&#x27;Missing bewit attributes&#x27;));
    }

    // Construct URL without bewit

    let url = resource[1];
    if (resource[4]) {
        url = url + resource[2] + resource[4];
    }

    // Check expiration

    if (bewit.exp * 1000 &#x3c;= now) {
        return callback(Utils.unauthorized(&#x27;Access expired&#x27;), null, bewit);
    }

    // Fetch Hawk credentials

    credentialsFunc(bewit.id, (err, credentials) =&#x3e; {

        if (err) {
            return callback(err, credentials || null, bewit.ext);
        }

        if (!credentials) {
            return callback(Utils.unauthorized(&#x27;Unknown credentials&#x27;), null, bewit);
        }

        if (!credentials.key ||
            !credentials.algorithm) {

            return callback(Boom.internal(&#x27;Invalid credentials&#x27;), credentials, bewit);
        }

        if (Crypto.algorithms.indexOf(credentials.algorithm) === -1) {
            return callback(Boom.internal(&#x27;Unknown algorithm&#x27;), credentials, bewit);
        }

        // Calculate MAC

        const mac = Crypto.calculateMac(&#x27;bewit&#x27;, credentials, {
            ts: bewit.exp,
            nonce: &#x27;&#x27;,
            method: &#x27;GET&#x27;,
            resource: url,
            host: request.host,
            port: request.port,
            ext: bewit.ext
        });

        if (!Cryptiles.fixedTimeComparison(mac, bewit.mac)) {
            return callback(Utils.unauthorized(&#x27;Bad mac&#x27;), credentials, bewit);
        }

        // Successful authentication

        return callback(null, credentials, bewit);
    });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.hawk.server.authenticateMessage" id="apidoc.element.hawk.server.authenticateMessage">
        function <span class="apidocSignatureSpan">hawk.server.</span>authenticateMessage
        <span class="apidocSignatureSpan">(host, port, message, authorization, credentialsFunc, options, callback)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">authenticateMessage = function (host, port, message, authorization, credentialsFunc, options, callback) {

    callback = Hoek.nextTick(callback);

    // Default options

    options.nonceFunc = options.nonceFunc || internals.nonceFunc;
    options.timestampSkewSec = options.timestampSkewSec || 60;                                                  // 60 seconds

    // Application time

    const now = Utils.now(options.localtimeOffsetMsec);                       // Measure now before any other processing

    // Validate authorization

    if (!authorization.id ||
        !authorization.ts ||
        !authorization.nonce ||
        !authorization.hash ||
        !authorization.mac) {

        return callback(Boom.badRequest(&#x27;Invalid authorization&#x27;));
    }

    // Fetch Hawk credentials

    credentialsFunc(authorization.id, (err, credentials) =&#x3e; {

        if (err) {
            return callback(err, credentials || null);
        }

        if (!credentials) {
            return callback(Utils.unauthorized(&#x27;Unknown credentials&#x27;));
        }

        if (!credentials.key ||
            !credentials.algorithm) {

            return callback(Boom.internal(&#x27;Invalid credentials&#x27;), credentials);
        }

        if (Crypto.algorithms.indexOf(credentials.algorithm) === -1) {
            return callback(Boom.internal(&#x27;Unknown algorithm&#x27;), credentials);
        }

        // Construct artifacts container

        const artifacts = {
            ts: authorization.ts,
            nonce: authorization.nonce,
            host,
            port,
            hash: authorization.hash
        };

        // Calculate MAC

        const mac = Crypto.calculateMac(&#x27;message&#x27;, credentials, artifacts);
        if (!Cryptiles.fixedTimeComparison(mac, authorization.mac)) {
            return callback(Utils.unauthorized(&#x27;Bad mac&#x27;), credentials);
        }

        // Check payload hash

        const hash = Crypto.calculatePayloadHash(message, credentials.algorithm);
        if (!Cryptiles.fixedTimeComparison(hash, authorization.hash)) {
            return callback(Utils.unauthorized(&#x27;Bad message hash&#x27;), credentials);
        }

        // Check nonce

        options.nonceFunc(credentials.key, authorization.nonce, authorization.ts, (err) =&#x3e; {

            if (err) {
                return callback(Utils.unauthorized(&#x27;Invalid nonce&#x27;), credentials);
            }

            // Check timestamp staleness

            if (Math.abs((authorization.ts * 1000) - now) &#x3e; (options.timestampSkewSec * 1000)) {
                return callback(Utils.unauthorized(&#x27;Stale timestamp&#x27;), credentials);
            }

            // Successful authentication

            return callback(null, credentials);
        });
    });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.hawk.server.authenticatePayload" id="apidoc.element.hawk.server.authenticatePayload">
        function <span class="apidocSignatureSpan">hawk.server.</span>authenticatePayload
        <span class="apidocSignatureSpan">(payload, credentials, artifacts, contentType)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">authenticatePayload = function (payload, credentials, artifacts, contentType) {

    const calculatedHash = Crypto.calculatePayloadHash(payload, credentials.algorithm, contentType);
    return Cryptiles.fixedTimeComparison(calculatedHash, artifacts.hash);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.hawk.server.authenticatePayloadHash" id="apidoc.element.hawk.server.authenticatePayloadHash">
        function <span class="apidocSignatureSpan">hawk.server.</span>authenticatePayloadHash
        <span class="apidocSignatureSpan">(calculatedHash, artifacts)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">authenticatePayloadHash = function (calculatedHash, artifacts) {

    return Cryptiles.fixedTimeComparison(calculatedHash, artifacts.hash);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.hawk.server.header" id="apidoc.element.hawk.server.header">
        function <span class="apidocSignatureSpan">hawk.server.</span>header
        <span class="apidocSignatureSpan">(credentials, artifacts, options)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">header = function (credentials, artifacts, options) {

    // Prepare inputs

    options = options || {};

    if (!artifacts ||
        typeof artifacts !== &#x27;object&#x27; ||
        typeof options !== &#x27;object&#x27;) {

        return &#x27;&#x27;;
    }

    artifacts = Hoek.clone(artifacts);
    delete artifacts.mac;
    artifacts.hash = options.hash;
    artifacts.ext = options.ext;

    // Validate credentials

    if (!credentials ||
        !credentials.key ||
        !credentials.algorithm) {

        // Invalid credential object
        return &#x27;&#x27;;
    }

    if (Crypto.algorithms.indexOf(credentials.algorithm) === -1) {
        return &#x27;&#x27;;
    }

    // Calculate payload hash

    if (!artifacts.hash &#x26;&#x26;
        (options.payload || options.payload === &#x27;&#x27;)) {

        artifacts.hash = Crypto.calculatePayloadHash(options.payload, credentials.algorithm, options.contentType);
    }

    const mac = Crypto.calculateMac(&#x27;response&#x27;, credentials, artifacts);

    // Construct header

    let header = &#x27;Hawk mac=&#x22;&#x27; + mac + &#x27;&#x22;&#x27; +
                 (artifacts.hash ? &#x27;, hash=&#x22;&#x27; + artifacts.hash + &#x27;&#x22;&#x27; : &#x27;&#x27;);

    if (artifacts.ext !== null &#x26;&#x26;
        artifacts.ext !== undefined &#x26;&#x26;
        artifacts.ext !== &#x27;&#x27;) {                       // Other falsey values allowed

        header = header + &#x27;, ext=&#x22;&#x27; + Hoek.escapeHeaderAttribute(artifacts.ext) + &#x27;&#x22;&#x27;;
    }

    return header;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    // Prepare response

    const payload = (!err ? `Hello ${credentials.user} ${artifacts.ext}` : &#x27;Shoosh!&#x27;);
    const headers = { &#x27;Content-Type&#x27;: &#x27;text/plain&#x27; };

    // Generate Server-Authorization response header

    const header = Hawk.server.<span class="apidocCodeKeywordSpan">header</span>(credentials, artifacts, { payload, contentType:
headers[&#x27;Content-Type&#x27;] });
    headers[&#x27;Server-Authorization&#x27;] = header;

    // Send the response back

    res.writeHead(!err ? 200 : 401, headers);
    res.end(payload);
});
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.hawk.sntp" id="apidoc.module.hawk.sntp">module hawk.sntp</a></h1>


    <h2>
        <a href="#apidoc.element.hawk.sntp.isLive" id="apidoc.element.hawk.sntp.isLive">
        function <span class="apidocSignatureSpan">hawk.sntp.</span>isLive
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">isLive = function () {

    return !!internals.now.intervalId;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.hawk.sntp.now" id="apidoc.element.hawk.sntp.now">
        function <span class="apidocSignatureSpan">hawk.sntp.</span>now
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">now = function () {

    const now = Date.now();
    if (!exports.isLive() ||
        now &#x3e;= internals.last.expires) {

        return now;
    }

    return now + internals.last.offset;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    key: &#x27;aoijedoaijsdlaksjdl&#x27;,
    algorithm: &#x27;sha256&#x27;                                 // &#x27;sha1&#x27;, &#x27;sha256&#x27;
},

// Optional

ext: &#x27;application-specific&#x27;,                        // Application specific data sent via the ext attribute
timestamp: Date.<span class="apidocCodeKeywordSpan">now</span>() / 1000,                       // A pre-calculated timestamp in
seconds
nonce: &#x27;2334f34f&#x27;,                                  // A pre-generated nonce
localtimeOffsetMsec: 400,                           // Time offset to sync with server time (ignored if timestamp provided)
payload: &#x27;{&#x22;some&#x22;:&#x22;payload&#x22;}&#x27;,                      // UTF-8 encoded string for body hash generation
 (ignored if hash provided)
contentType: &#x27;application/json&#x27;,                    // Payload content-type (ignored if hash provided)
hash: &#x27;U4MKKSmiVxk37JCCrAVIjV=&#x27;,                    // Pre-calculated payload hash
app: &#x27;24s23423f34dx&#x27;,                               // Oz application id
dlg: &#x27;234sz34tww3sd&#x27;                                // Oz delegated-by application id
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.hawk.sntp.offset" id="apidoc.element.hawk.sntp.offset">
        function <span class="apidocSignatureSpan">hawk.sntp.</span>offset
        <span class="apidocSignatureSpan">(options, callback)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">offset = function (options, callback) {

    if (arguments.length !== 2) {
        callback = arguments[0];
        options = {};
    }

    const now = Date.now();
    const clockSyncRefresh = options.clockSyncRefresh || 24 * 60 * 60 * 1000;                    // Daily

    if (internals.last.offset &#x26;&#x26;
        internals.last.host === options.host &#x26;&#x26;
        internals.last.port === options.port &#x26;&#x26;
        now &#x3c; internals.last.expires) {

        process.nextTick(() =&#x3e; callback(null, internals.last.offset));
        return;
    }

    exports.time(options, (err, time) =&#x3e; {

        if (err) {
            return callback(err, 0);
        }

        internals.last = {
            offset: Math.round(time.t),
            expires: now + clockSyncRefresh,
            host: options.host,
            port: options.port
        };

        return callback(null, internals.last.offset);
    });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.hawk.sntp.start" id="apidoc.element.hawk.sntp.start">
        function <span class="apidocSignatureSpan">hawk.sntp.</span>start
        <span class="apidocSignatureSpan">(options, callback)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">start = function (options, callback) {

    if (arguments.length !== 2) {
        callback = arguments[0];
        options = {};
    }

    if (internals.now.intervalId) {
        process.nextTick(() =&#x3e; callback());
        return;
    }

    exports.offset(options, (ignoreErr, offset) =&#x3e; {

        internals.now.intervalId = setInterval(() =&#x3e; {

            exports.offset(options, Hoek.ignore);
        }, options.clockSyncRefresh || 24 * 60 * 60 * 1000);                                // Daily

        return callback();
    });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
});
```

**Hawk** utilized the [**SNTP**](https://github.com/hueniverse/sntp) module for time sync management. By default, the local
machine time is used. To automatically retrieve and synchronize the clock within the application, use the SNTP &#x27;start()&#x27
; method.

```javascript
Hawk.sntp.<span class="apidocCodeKeywordSpan">start</span>();
```


## Protocol Example

The client attempts to access a protected resource without authentication, sending the following HTTP request to
the resource server:
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.hawk.sntp.stop" id="apidoc.element.hawk.sntp.stop">
        function <span class="apidocSignatureSpan">hawk.sntp.</span>stop
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">stop = function () {

    if (!internals.now.intervalId) {
        return;
    }

    clearInterval(internals.now.intervalId);
    internals.now.intervalId = 0;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.hawk.sntp.time" id="apidoc.element.hawk.sntp.time">
        function <span class="apidocSignatureSpan">hawk.sntp.</span>time
        <span class="apidocSignatureSpan">(options, callback)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">time = function (options, callback) {

    if (arguments.length !== 2) {
        callback = arguments[0];
        options = {};
    }

    const settings = Hoek.clone(options);
    settings.host = settings.host || &#x27;pool.ntp.org&#x27;;
    settings.port = settings.port || 123;
    settings.resolveReference = settings.resolveReference || false;

    // Declare variables used by callback

    let timeoutId = 0;
    let sent = 0;

    // Ensure callback is only called once

    const finish = Hoek.once((err, result) =&#x3e; {

        if (timeoutId) {
            clearTimeout(timeoutId);
            timeoutId = 0;
        }

        socket.removeAllListeners();
        socket.once(&#x27;error&#x27;, Hoek.ignore);
        socket.close();
        return callback(err, result);
    });

    // Create UDP socket

    const socket = Dgram.createSocket(&#x27;udp4&#x27;);

    socket.once(&#x27;error&#x27;, (err) =&#x3e; finish(err));

    // Listen to incoming messages

    socket.on(&#x27;message&#x27;, (buffer, rinfo) =&#x3e; {

        const received = Date.now();

        const message = new internals.NtpMessage(buffer);
        if (!message.isValid) {
            return finish(new Error(&#x27;Invalid server response&#x27;), message);
        }

        if (message.originateTimestamp !== sent) {
            return finish(new Error(&#x27;Wrong originate timestamp&#x27;), message);
        }

        // Timestamp Name          ID   When Generated
        // ------------------------------------------------------------
        // Originate Timestamp     T1   time request sent by client
        // Receive Timestamp       T2   time request received by server
        // Transmit Timestamp      T3   time reply sent by server
        // Destination Timestamp   T4   time reply received by client
        //
        // The roundtrip delay d and system clock offset t are defined as:
        //
        // d = (T4 - T1) - (T3 - T2)     t = ((T2 - T1) + (T3 - T4)) / 2

        const T1 = message.originateTimestamp;
        const T2 = message.receiveTimestamp;
        const T3 = message.transmitTimestamp;
        const T4 = received;

        message.d = (T4 - T1) - (T3 - T2);
        message.t = ((T2 - T1) + (T3 - T4)) / 2;
        message.receivedLocally = received;

        if (!settings.resolveReference ||
            message.stratum !== &#x27;secondary&#x27;) {

            return finish(null, message);
        }

        // Resolve reference IP address

        Dns.reverse(message.referenceId, (err, domains) =&#x3e; {

            if (/* $lab:coverage:off$ */ !err /* $lab:coverage:on$ */) {
                message.referenceHost = domains[0];
            }

            return finish(null, message);
        });
    });

    // Set timeout

    if (settings.timeout) {
        timeoutId = setTimeout(() =&#x3e; {

            timeoutId = 0;
            return finish(new Error(&#x27;Timeout&#x27;));
        }, settings.timeout);
    }

    // Construct NTP message

    const message = new Buffer(48);
    for (let i = 0; i &#x3c; 48; ++i) {                      // Zero message
        message[i] = 0;
    }

    message[0] = (0 &#x3c;&#x3c; 6) + (4 &#x3c;&#x3c; 3) + (3 &#x3c;&#x3c; 0);        // Set version number to 4 and Mode to 3 (client)
    sent = Date.now();
    internals.fromMsecs(sent, message, 40);             // Set transmit timestamp (returns as originate)

    // Send NTP request

    socket.send(message, 0, message.length, settings.port, settings.host, (err, bytes) =&#x3e; {

        if (err ||
            bytes !== 48) {

            return finish(err || new Error(&#x27;Could not send entire message&#x27;));
        }
    });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.hawk.uri" id="apidoc.module.hawk.uri">module hawk.uri</a></h1>


    <h2>
        <a href="#apidoc.element.hawk.uri.authenticate" id="apidoc.element.hawk.uri.authenticate">
        function <span class="apidocSignatureSpan">hawk.uri.</span>authenticate
        <span class="apidocSignatureSpan">(req, credentialsFunc, options, callback)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">authenticate = function (req, credentialsFunc, options, callback) {

    callback = Hoek.nextTick(callback);

    // Application time

    const now = Utils.now(options.localtimeOffsetMsec);

    // Convert node Http request object to a request configuration object

    const request = Utils.parseRequest(req, options);
    if (request instanceof Error) {
        return callback(Boom.badRequest(request.message));
    }

    // Extract bewit

    if (request.url.length &#x3e; Utils.limits.maxMatchLength) {
        return callback(Boom.badRequest(&#x27;Resource path exceeds max length&#x27;));
    }

    const resource = request.url.match(internals.bewitRegex);
    if (!resource) {
        return callback(Utils.unauthorized());
    }

    // Bewit not empty

    if (!resource[3]) {
        return callback(Utils.unauthorized(&#x27;Empty bewit&#x27;));
    }

    // Verify method is GET

    if (request.method !== &#x27;GET&#x27; &#x26;&#x26;
        request.method !== &#x27;HEAD&#x27;) {

        return callback(Utils.unauthorized(&#x27;Invalid method&#x27;));
    }

    // No other authentication

    if (request.authorization) {
        return callback(Boom.badRequest(&#x27;Multiple authentications&#x27;));
    }

    // Parse bewit

    const bewitString = Hoek.base64urlDecode(resource[3]);
    if (bewitString instanceof Error) {
        return callback(Boom.badRequest(&#x27;Invalid bewit encoding&#x27;));
    }

    // Bewit format: id\exp\mac\ext (&#x27;\&#x27; is used because it is a reserved header attribute character)

    const bewitParts = bewitString.split(&#x27;\\&#x27;);
    if (bewitParts.length !== 4) {
        return callback(Boom.badRequest(&#x27;Invalid bewit structure&#x27;));
    }

    const bewit = {
        id: bewitParts[0],
        exp: parseInt(bewitParts[1], 10),
        mac: bewitParts[2],
        ext: bewitParts[3] || &#x27;&#x27;
    };

    if (!bewit.id ||
        !bewit.exp ||
        !bewit.mac) {

        return callback(Boom.badRequest(&#x27;Missing bewit attributes&#x27;));
    }

    // Construct URL without bewit

    let url = resource[1];
    if (resource[4]) {
        url = url + resource[2] + resource[4];
    }

    // Check expiration

    if (bewit.exp * 1000 &#x3c;= now) {
        return callback(Utils.unauthorized(&#x27;Access expired&#x27;), null, bewit);
    }

    // Fetch Hawk credentials

    credentialsFunc(bewit.id, (err, credentials) =&#x3e; {

        if (err) {
            return callback(err, credentials || null, bewit.ext);
        }

        if (!credentials) {
            return callback(Utils.unauthorized(&#x27;Unknown credentials&#x27;), null, bewit);
        }

        if (!credentials.key ||
            !credentials.algorithm) {

            return callback(Boom.internal(&#x27;Invalid credentials&#x27;), credentials, bewit);
        }

        if (Crypto.algorithms.indexOf(credentials.algorithm) === -1) {
            return callback(Boom.internal(&#x27;Unknown algorithm&#x27;), credentials, bewit);
        }

        // Calculate MAC

        const mac = Crypto.calculateMac(&#x27;bewit&#x27;, credentials, {
            ts: bewit.exp,
            nonce: &#x27;&#x27;,
            method: &#x27;GET&#x27;,
            resource: url,
            host: request.host,
            port: request.port,
            ext: bewit.ext
        });

        if (!Cryptiles.fixedTimeComparison(mac, bewit.mac)) {
            return callback(Utils.unauthorized(&#x27;Bad mac&#x27;), credentials, bewit);
        }

        // Successful authentication

        return callback(null, credentials, bewit);
    });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

// Create HTTP server

const handler = function (req, res) {

    // Authenticate incoming request

    Hawk.server.<span class="apidocCodeKeywordSpan">authenticate</span>(req, credentialsFunc, {}, (err, credentials, artifacts) =&#
x3e; {

// Prepare response

const payload = (!err ? `Hello ${credentials.user} ${artifacts.ext}` : &#x27;Shoosh!&#x27;);
const headers = { &#x27;Content-Type&#x27;: &#x27;text/plain&#x27; };

// Generate Server-Authorization response header
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.hawk.uri.getBewit" id="apidoc.element.hawk.uri.getBewit">
        function <span class="apidocSignatureSpan">hawk.uri.</span>getBewit
        <span class="apidocSignatureSpan">(uri, options)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">getBewit = function (uri, options) {

    // Validate inputs

    if (!uri ||
        (typeof uri !== &#x27;string&#x27; &#x26;&#x26; typeof uri !== &#x27;object&#x27;) ||
        !options ||
        typeof options !== &#x27;object&#x27; ||
        !options.ttlSec) {

        return &#x27;&#x27;;
    }

    options.ext = (options.ext === null || options.ext === undefined ? &#x27;&#x27; : options.ext);       // Zero is valid value

    // Application time

    const now = Utils.now(options.localtimeOffsetMsec);

    // Validate credentials

    const credentials = options.credentials;
    if (!credentials ||
        !credentials.id ||
        !credentials.key ||
        !credentials.algorithm) {

        return &#x27;&#x27;;
    }

    if (Crypto.algorithms.indexOf(credentials.algorithm) === -1) {
        return &#x27;&#x27;;
    }

    // Parse URI

    if (typeof uri === &#x27;string&#x27;) {
        uri = Url.parse(uri);
    }

    // Calculate signature

    const exp = Math.floor(now / 1000) + options.ttlSec;
    const mac = Crypto.calculateMac(&#x27;bewit&#x27;, credentials, {
        ts: exp,
        nonce: &#x27;&#x27;,
        method: &#x27;GET&#x27;,
        resource: uri.pathname + (uri.search || &#x27;&#x27;),                            // Maintain trailing &#x27;?&#x27;
        host: uri.hostname,
        port: uri.port || (uri.protocol === &#x27;http:&#x27; ? 80 : 443),
        ext: options.ext
    });

    // Construct bewit: id\exp\mac\ext

    const bewit = credentials.id + &#x27;\\&#x27; + exp + &#x27;\\&#x27; + mac + &#x27;\\&#x27; + options.ext;
    return Hoek.base64urlEncode(bewit);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    key: &#x27;werxhqb98rpaxn39848xrunpaw3489ruxnpa98w4rxn&#x27;,
    algorithm: &#x27;sha256&#x27;
}

// Generate bewit

const duration = 60 * 5;      // 5 Minutes
const bewit = Hawk.uri.<span class="apidocCodeKeywordSpan">getBewit</span>(&#x27;http://example.com:8000/resource/1?b=1&#x26;a=2
&#x27;, { credentials: credentials, ttlSec: duration, ext: &#x27;some-app-data&#x27; });
const uri = &#x27;http://example.com:8000/resource/1?b=1&#x26;a=2&#x27; + &#x27;&#x26;bewit=&#x27; + bewit;

// Output URI

console.log(&#x27;URI: &#x27; + uri);
```
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.hawk.utils" id="apidoc.module.hawk.utils">module hawk.utils</a></h1>


    <h2>
        <a href="#apidoc.element.hawk.utils.now" id="apidoc.element.hawk.utils.now">
        function <span class="apidocSignatureSpan">hawk.utils.</span>now
        <span class="apidocSignatureSpan">(localtimeOffsetMsec)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">now = function (localtimeOffsetMsec) {

    return Sntp.now() + (localtimeOffsetMsec || 0);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    key: &#x27;aoijedoaijsdlaksjdl&#x27;,
    algorithm: &#x27;sha256&#x27;                                 // &#x27;sha1&#x27;, &#x27;sha256&#x27;
},

// Optional

ext: &#x27;application-specific&#x27;,                        // Application specific data sent via the ext attribute
timestamp: Date.<span class="apidocCodeKeywordSpan">now</span>() / 1000,                       // A pre-calculated timestamp in
seconds
nonce: &#x27;2334f34f&#x27;,                                  // A pre-generated nonce
localtimeOffsetMsec: 400,                           // Time offset to sync with server time (ignored if timestamp provided)
payload: &#x27;{&#x22;some&#x22;:&#x22;payload&#x22;}&#x27;,                      // UTF-8 encoded string for body hash generation
 (ignored if hash provided)
contentType: &#x27;application/json&#x27;,                    // Payload content-type (ignored if hash provided)
hash: &#x27;U4MKKSmiVxk37JCCrAVIjV=&#x27;,                    // Pre-calculated payload hash
app: &#x27;24s23423f34dx&#x27;,                               // Oz application id
dlg: &#x27;234sz34tww3sd&#x27;                                // Oz delegated-by application id
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.hawk.utils.nowSecs" id="apidoc.element.hawk.utils.nowSecs">
        function <span class="apidocSignatureSpan">hawk.utils.</span>nowSecs
        <span class="apidocSignatureSpan">(localtimeOffsetMsec)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">nowSecs = function (localtimeOffsetMsec) {

    return Math.floor(exports.now(localtimeOffsetMsec) / 1000);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.hawk.utils.parseAuthorizationHeader" id="apidoc.element.hawk.utils.parseAuthorizationHeader">
        function <span class="apidocSignatureSpan">hawk.utils.</span>parseAuthorizationHeader
        <span class="apidocSignatureSpan">(header, keys)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">parseAuthorizationHeader = function (header, keys) {

    keys = keys || [&#x27;id&#x27;, &#x27;ts&#x27;, &#x27;nonce&#x27;, &#x27;hash&#x27;, &#x27;ext&#x27;, &#x27;mac&#x27;, &#x27;app&#x27;, &#x27;dlg&#x27;];

    if (!header) {
        return Boom.unauthorized(null, &#x27;Hawk&#x27;);
    }

    if (header.length &#x3e; exports.limits.maxMatchLength) {
        return Boom.badRequest(&#x27;Header length too long&#x27;);
    }

    const headerParts = header.match(internals.authHeaderRegex);
    if (!headerParts) {
        return Boom.badRequest(&#x27;Invalid header syntax&#x27;);
    }

    const scheme = headerParts[1];
    if (scheme.toLowerCase() !== &#x27;hawk&#x27;) {
        return Boom.unauthorized(null, &#x27;Hawk&#x27;);
    }

    const attributesString = headerParts[2];
    if (!attributesString) {
        return Boom.badRequest(&#x27;Invalid header syntax&#x27;);
    }

    const attributes = {};
    let errorMessage = &#x27;&#x27;;
    const verify = attributesString.replace(/(\w+)=&#x22;([^&#x22;\\]*)&#x22;\s*(?:,\s*|$)/g, ($0, $1, $2) =&#x3e; {

        // Check valid attribute names

        if (keys.indexOf($1) === -1) {
            errorMessage = &#x27;Unknown attribute: &#x27; + $1;
            return;
        }

        // Allowed attribute value characters

        if ($2.match(internals.attributeRegex) === null) {
            errorMessage = &#x27;Bad attribute value: &#x27; + $1;
            return;
        }

        // Check for duplicates

        if (attributes.hasOwnProperty($1)) {
            errorMessage = &#x27;Duplicate attribute: &#x27; + $1;
            return;
        }

        attributes[$1] = $2;
        return &#x27;&#x27;;
    });

    if (verify !== &#x27;&#x27;) {
        return Boom.badRequest(errorMessage || &#x27;Bad header format&#x27;);
    }

    return attributes;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
        };

        const wwwAuthenticate = getHeader(&#x27;www-authenticate&#x27;);
        if (wwwAuthenticate) {

// Parse HTTP WWW-Authenticate header

const wwwAttributes = hawk.utils.<span class="apidocCodeKeywordSpan">parseAuthorizationHeader</span>(wwwAuthenticate, [&#x27;ts&#
x27;, &#x27;tsm&#x27;, &#x27;error&#x27;]);
if (!wwwAttributes) {
    return false;
}

if (wwwAttributes.ts) {
    const tsm = hawk.crypto.calculateTsMac(wwwAttributes.ts, credentials);
    if (tsm !== wwwAttributes.tsm) {
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.hawk.utils.parseContentType" id="apidoc.element.hawk.utils.parseContentType">
        function <span class="apidocSignatureSpan">hawk.utils.</span>parseContentType
        <span class="apidocSignatureSpan">(header)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">parseContentType = function (header) {

    if (!header) {
        return &#x27;&#x27;;
    }

    return header.split(&#x27;;&#x27;)[0].trim().toLowerCase();
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    return normalized;
},

calculatePayloadHash: function (payload, algorithm, contentType) {

    const hash = CryptoJS.algo[algorithm.toUpperCase()].create();
    hash.update(&#x27;hawk.&#x27; + hawk.crypto.headerVersion + &#x27;.payload\n&#x27;);
    hash.update(hawk.utils.<span class="apidocCodeKeywordSpan">parseContentType</span>(contentType) + &#x27;\n&#x27;);
    hash.update(payload);
    hash.update(&#x27;\n&#x27;);
    return hash.finalize().toString(CryptoJS.enc.Base64);
},

calculateTsMac: function (ts, credentials) {
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.hawk.utils.parseHost" id="apidoc.element.hawk.utils.parseHost">
        function <span class="apidocSignatureSpan">hawk.utils.</span>parseHost
        <span class="apidocSignatureSpan">(req, hostHeaderName)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">parseHost = function (req, hostHeaderName) {

    hostHeaderName = (hostHeaderName ? hostHeaderName.toLowerCase() : &#x27;host&#x27;);
    const hostHeader = req.headers[hostHeaderName];
    if (!hostHeader) {
        return null;
    }

    if (hostHeader.length &#x3e; exports.limits.maxMatchLength) {
        return null;
    }

    const hostParts = hostHeader.match(internals.hostHeaderRegex);
    if (!hostParts) {
        return null;
    }

    return {
        name: hostParts[1],
        port: (hostParts[2] ? hostParts[2] : (req.connection &#x26;&#x26; req.connection.encrypted ? 443 : 80))
    };
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.hawk.utils.parseRequest" id="apidoc.element.hawk.utils.parseRequest">
        function <span class="apidocSignatureSpan">hawk.utils.</span>parseRequest
        <span class="apidocSignatureSpan">(req, options)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">parseRequest = function (req, options) {

    if (!req.headers) {
        return req;
    }

    // Obtain host and port information

    let host;
    if (!options.host ||
        !options.port) {

        host = exports.parseHost(req, options.hostHeaderName);
        if (!host) {
            return new Error(&#x27;Invalid Host header&#x27;);
        }
    }

    const request = {
        method: req.method,
        url: req.url,
        host: options.host || host.name,
        port: options.port || host.port,
        authorization: req.headers.authorization,
        contentType: req.headers[&#x27;content-type&#x27;] || &#x27;&#x27;
    };

    return request;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.hawk.utils.unauthorized" id="apidoc.element.hawk.utils.unauthorized">
        function <span class="apidocSignatureSpan">hawk.utils.</span>unauthorized
        <span class="apidocSignatureSpan">(message, attributes)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">unauthorized = function (message, attributes) {

    return Boom.unauthorized(message || null, &#x27;Hawk&#x27;, attributes);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.hawk.utils.version" id="apidoc.element.hawk.utils.version">
        function <span class="apidocSignatureSpan">hawk.utils.</span>version
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">version = function () {

    return require(&#x27;../package.json&#x27;).version;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>




</div>

<div class="apidocFooterDiv">
    [ this document was created with
    <a href="https://github.com/kaizhu256/node-utility2" target="_blank">utility2</a>
    ]
</div>
</div>
